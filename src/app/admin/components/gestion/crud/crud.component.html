<app-modal-periodo-reservas (periodoActualizado)="obtenerPeriodoActual()"></app-modal-periodo-reservas>

<app-modal-nuevo [modo]="modo" (entidadCreada)="reloadTable()"></app-modal-nuevo>
<app-modal-editar [modo]="modo" [idEntidad]="getIdEntidadSeleccionada()" (entidadActualizada)="reloadTable()"></app-modal-editar>
<app-modal-filtro [modo]="modo"></app-modal-filtro>
<app-modal-ver [modo]="modo" [idEntidad]="getIdEntidadSeleccionada()" (estadoActualizado)="reloadTable()"></app-modal-ver>

<div class="d-flex">
  <div class="content w-100 p-5">
    <div class="d-flex justify-content-between align-items-center">
      <h2 class="mb-0 d-flex align-items-center">
        {{ modo | titlecase }}
        <div *ngIf="isLoadingTable" class="spinner-border text-primary ms-3" role="status" style="width: 1.5rem; height: 1.5rem;">
          <span class="visually-hidden">Cargando...</span>
        </div>
      </h2>
      <!-- Mini-card para período de reservas -->
      <div *ngIf="modo === 'reservas'" class="periodo-mini-card d-flex align-items-center">
        <div class="me-3">
          <span class="badge me-2" [ngClass]="{
            'bg-success': esPeriodoActivo(),
            'bg-warning': !esPeriodoActivo() && esPeriodoFuturo(),
            'bg-danger': !esPeriodoActivo() && !esPeriodoFuturo()
          }">
            <i class="fas" [ngClass]="{
              'fa-check-circle': esPeriodoActivo(),
              'fa-clock': !esPeriodoActivo() && esPeriodoFuturo(),
              'fa-times-circle': !esPeriodoActivo() && !esPeriodoFuturo()
            }"></i>
            {{ getEstadoPeriodo() }}
          </span>
          <span class="text-muted" *ngIf="periodoActual">
            <i class="fas fa-calendar-alt me-1"></i>
            {{ periodoActual.fechaInicio | date:'dd/MM/yyyy' }} - {{ periodoActual.fechaFin | date:'dd/MM/yyyy' }}
          </span>
          <span class="text-muted" *ngIf="!periodoActual">
            <i class="fas fa-info-circle me-1"></i>
            No hay período configurado
          </span>
        </div>
        <button type="button" class="btn btn-outline-primary btn-sm rounded-pill d-flex align-items-center justify-content-center" 
          data-bs-toggle="modal" 
          data-bs-target="#gestionReservas"
          title="Editar período de reservas"
          style="min-width: 36px; height: 36px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s ease;">
           <i class="fas fa-edit" style="font-size: 14px;"></i>
        </button>
      </div>  
      <div *ngIf="modo !== 'reservas'" class="d-flex justify-content-end align-items-center gap-2 mb-2">
        <button class="btn btn-primary btn-sm" *ngIf="modo === 'libros' || modo === 'editoriales'" data-bs-toggle="modal" [attr.data-bs-target]="'#nuevo' + modo">
          + Añadir {{ modo === 'libros' ? 'libro' : 'editorial' }}
        </button>
      </div>
    </div>

    <div class="table-container">
      <!-- Switch para filtrar activos/todos -->
      <div *ngIf="modo !== 'reservas'" class="filtro-estado-container mb-3 d-flex align-items-center">
        <span class="me-2">Mostrar:</span>
        
        <div class="filtro-switch-group">
          <span [class.active]="filtroEstado === 'activo'" (click)="cambiarFiltroEstado('activo')">Activos</span>
          <label class="switch mx-2">
            <input type="checkbox" [checked]="filtroEstado === 'todos'" (change)="toggleFiltroEstado($event)">
            <span class="slider round"></span>
          </label>
          <span [class.active]="filtroEstado === 'todos'" (click)="cambiarFiltroEstado('todos')">Todos</span>
        </div>
        
        <small class="text-muted ms-auto">
          <i class="fas fa-info-circle me-1"></i> También puedes escribir <strong>"activo"</strong> o <strong>"inactivo"</strong> en el buscador.
        </small>
      </div>
      
      <!-- Filtro de reservas con diseño mejorado -->
      <div *ngIf="modo === 'reservas'" class="filtro-estado-container mb-4">
        <div class="d-flex align-items-center justify-content-between">
          <div class="d-flex align-items-center gap-3">
            <h6 class="mb-0 text-muted">
              <i class="fas fa-filter me-2"></i>Mostrar:
            </h6>
            
            <div class="btn-group filter-pills" role="group" aria-label="Filtro de reservas">
              <input type="radio" class="btn-check" name="filtroReservas" id="todas" 
                     [checked]="filtroReservas === 'todas'"
                     (change)="cambiarFiltroReservas('todas')">
              <label class="btn btn-pill" for="todas">
                <i class="fas fa-list-ul me-2"></i>Todas
              </label>

              <input type="radio" class="btn-check" name="filtroReservas" id="verificadas" 
                     [checked]="filtroReservas === 'verificadas'"
                     (change)="cambiarFiltroReservas('verificadas')">
              <label class="btn btn-pill" for="verificadas">
                <i class="fas fa-check-circle me-2"></i>Verificadas
              </label>

              <input type="radio" class="btn-check" name="filtroReservas" id="no-verificadas" 
                     [checked]="filtroReservas === 'no-verificadas'"
                     (change)="cambiarFiltroReservas('no-verificadas')">
              <label class="btn btn-pill" for="no-verificadas">
                <i class="fas fa-clock me-2"></i>Pendientes
              </label>
            </div>
          </div>

          <small class="text-muted d-flex align-items-center">
            <i class="fas fa-search me-2"></i>
            Puedes filtrar por "Todas" / "Verificadas" / "Pendientes" [No Verificadas]
          </small>
        </div>
      </div>
      
      <!-- Tabla Libros -->
      <table datatable [dtOptions]="dtOptions" *ngIf="modo === 'libros'" 
            id="tablaLibros"
            class="table table-bordered table-hover table-striped" 
            style="border: 2px solid #6C8EBF;">
        <thead>
          <tr class="table-primary">
            <th></th>
            <th class="text-center">Nombre</th>
            <th class="text-center">ISBN</th>
            <th class="text-center">Editorial</th>
            <th class="text-center">Precio</th>
            <th class="text-center">Estado</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <!-- Tabla Editoriales -->
      <table datatable [dtOptions]="dtOptions" *ngIf="modo === 'editoriales'" 
            id="tablaEditoriales"
            class="table table-bordered table-hover table-striped" 
            style="border: 2px solid #6C8EBF;">
        <thead>
          <tr class="table-primary">
            <th></th>
            <th class="text-center">Nombre</th>
            <th class="text-center">Correo</th>
            <th class="text-center">Teléfono</th>
            <th class="text-center">Estado</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <!-- Tabla Reservas -->
      <table datatable [dtOptions]="dtOptions" *ngIf="modo === 'reservas'" 
        id="tablaReservas"
        class="table table-bordered table-hover table-striped" 
        style="border: 2px solid #6C8EBF;">
        <thead>
          <tr class="table-primary">
            <th></th>
            <th class="text-center" title="Nombre del alumno">Nombre</th>
            <th class="text-center" title="Apellidos del alumno">Apellidos</th>
            <th class="text-center" title="Fecha de realización">Registrada</th>
            <th class="text-center" title="Estado">Verificación</th>
            <th class="text-center" title="Curso del alumno">Curso</th>
            <th class="text-center" title="Importe total de la reserva">Importe</th>
            <th class="text-center" title="Libros reservados">Libros</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

    </div>
  </div>
</div>